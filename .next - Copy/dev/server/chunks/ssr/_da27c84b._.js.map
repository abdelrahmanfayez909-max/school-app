{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///F:/school/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://placeholder.supabase.co';\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || 'placeholder';\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\r\n\r\nexport type Student = {\r\n  id: string;\r\n  full_name: string;\r\n  national_id: string;\r\n  grade: string;\r\n  section: string;\r\n  dob: string;\r\n  phone: string;\r\n  address: string;\r\n  status: 'منتظم' | 'منقطع' | 'محول';\r\n  image_url?: string;\r\n  created_at?: string;\r\n};\r\n\r\nexport type Log = {\r\n  id: string;\r\n  action: string;\r\n  details: any;\r\n  user_id: string;\r\n  created_at: string;\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,gFAAwC;AAC5D,MAAM,kBAAkB,wPAA6C;AAE9D,MAAM,WAAW,IAAA,8LAAY,EAAC,aAAa"}},
    {"offset": {"line": 17, "column": 0}, "map": {"version":3,"sources":["file:///F:/school/app/dashboard/attendance/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { Calendar, Save, CheckCircle, XCircle } from 'lucide-react';\r\n\r\nexport default function AttendancePage() {\r\n    const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\r\n    const [grade, setGrade] = useState('الصف الأول الابتدائي');\r\n    const [classGroup, setClassGroup] = useState('1/1'); // Default to a class\r\n    const [students, setStudents] = useState<any[]>([]);\r\n    const [attendance, setAttendance] = useState<Record<string, string>>({});\r\n    const [loading, setLoading] = useState(false);\r\n    const [saving, setSaving] = useState(false);\r\n\r\n    // Fetch students and existing attendance for the date\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            setLoading(true);\r\n            try {\r\n                // 1. Get Students\r\n                const { data: studentsData } = await supabase\r\n                    .from('students')\r\n                    .select('id, full_name')\r\n                    .eq('grade', grade)\r\n                    .eq('class_group', classGroup) // Only show filtered class\r\n                    .eq('status', 'active')\r\n                    .order('full_name');\r\n\r\n                if (!studentsData) return;\r\n\r\n                // 2. Get Existing Attendance\r\n                const { data: attData } = await supabase\r\n                    .from('attendance')\r\n                    .select('student_id, status')\r\n                    .eq('date', date)\r\n                    .in('student_id', studentsData.map(s => s.id));\r\n\r\n                const attMap: Record<string, string> = {};\r\n                // Default all to 'absent' if no record, or 'present'\r\n                // Usually better to default to 'present' for ease? Gov schools default is everyone present except...\r\n                studentsData.forEach(s => attMap[s.id] = 'present');\r\n\r\n                if (attData) {\r\n                    attData.forEach((a: any) => attMap[a.student_id] = a.status);\r\n                }\r\n\r\n                setStudents(studentsData);\r\n                setAttendance(attMap);\r\n\r\n            } catch (error) {\r\n                console.error(error);\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        if (grade && classGroup) fetchData();\r\n    }, [grade, classGroup, date]);\r\n\r\n    const toggleStatus = (studentId: string) => {\r\n        setAttendance(prev => ({\r\n            ...prev,\r\n            [studentId]: prev[studentId] === 'present' ? 'absent' : 'present'\r\n        }));\r\n    };\r\n\r\n    const saveAttendance = async () => {\r\n        setSaving(true);\r\n        try {\r\n            const upsertData = students.map(s => ({\r\n                student_id: s.id,\r\n                date: date,\r\n                status: attendance[s.id]\r\n            }));\r\n\r\n            // This is naive upsert (attendance table needs unique constraint on student_id + date)\r\n            // Assuming we added that or handle it manually. \r\n            // For now, let's just insert. Ideally `upsert`.\r\n            // schema.sql didn't strictly add unique constraint, but assuming code-level handling:\r\n\r\n            // Delete existing for this day/class to be safe (simple atomic replacement)\r\n            const ids = students.map(s => s.id);\r\n            await supabase.from('attendance').delete().eq('date', date).in('student_id', ids);\r\n\r\n            const { error } = await supabase.from('attendance').insert(upsertData);\r\n            if (error) throw error;\r\n\r\n            alert('تم حفظ الغياب بنجاح');\r\n        } catch (error) {\r\n            console.error(error);\r\n            alert('حدث خطأ أثناء الحفظ');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={{ maxWidth: '1000px', margin: '0 auto' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>\r\n                <div>\r\n                    <h1 style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>رصد الغياب</h1>\r\n                    <p className=\"text-muted\">تسجيل الحضور والغياب اليومي</p>\r\n                </div>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                    <input\r\n                        type=\"date\"\r\n                        value={date}\r\n                        onChange={(e) => setDate(e.target.value)}\r\n                        className=\"input-field\"\r\n                        style={{ width: 'auto' }}\r\n                    />\r\n                    <button onClick={saveAttendance} disabled={saving} className=\"btn btn-primary\">\r\n                        <Save size={18} />\r\n                        <span>{saving ? 'جاري الحفظ' : 'حفظ الغياب'}</span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"card\" style={{ marginBottom: '1.5rem', display: 'flex', gap: '1rem' }}>\r\n                <select value={grade} onChange={(e) => setGrade(e.target.value)} className=\"input-field\">\r\n                    <option value=\"الصف الأول الابتدائي\">الصف الأول الابتدائي</option>\r\n                    <option value=\"الصف الثاني الابتدائي\">الصف الثاني الابتدائي</option>\r\n                    {/* ... */}\r\n                </select>\r\n                <input\r\n                    value={classGroup}\r\n                    onChange={(e) => setClassGroup(e.target.value)}\r\n                    className=\"input-field\"\r\n                    placeholder=\"الفصل (مثال 1/1)\"\r\n                />\r\n            </div>\r\n\r\n            <div className=\"card\" style={{ padding: 0 }}>\r\n                {loading ? (\r\n                    <div style={{ padding: '2rem', textAlign: 'center' }}>جاري التحميل...</div>\r\n                ) : (\r\n                    <div className=\"table-wrapper\">\r\n                        <table>\r\n                            <thead>\r\n                                <tr>\r\n                                    <th>#</th>\r\n                                    <th>اسم الطالب</th>\r\n                                    <th style={{ textAlign: 'center' }}>الحالة</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {students.map((student, i) => (\r\n                                    <tr key={student.id} onClick={() => toggleStatus(student.id)} style={{ cursor: 'pointer', background: attendance[student.id] === 'absent' ? '#fee2e2' : 'transparent' }}>\r\n                                        <td>{i + 1}</td>\r\n                                        <td style={{ fontWeight: 600 }}>{student.full_name}</td>\r\n                                        <td style={{ textAlign: 'center' }}>\r\n                                            {attendance[student.id] === 'present' ? (\r\n                                                <div style={{ display: 'inline-flex', alignItems: 'center', gap: '0.5rem', color: '#166534' }}>\r\n                                                    <CheckCircle size={20} />\r\n                                                    <span>حاضر</span>\r\n                                                </div>\r\n                                            ) : (\r\n                                                <div style={{ display: 'inline-flex', alignItems: 'center', gap: '0.5rem', color: '#991b1b' }}>\r\n                                                    <XCircle size={20} />\r\n                                                    <span>غائب</span>\r\n                                                </div>\r\n                                            )}\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAJA;;;;;AAMe,SAAS;IACpB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;IACvE,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC,QAAQ,qBAAqB;IAC1E,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAQ,EAAE;IAClD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAyB,CAAC;IACtE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IAErC,sDAAsD;IACtD,IAAA,kNAAS,EAAC;QACN,MAAM,YAAY;YACd,WAAW;YACX,IAAI;gBACA,kBAAkB;gBAClB,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,2HAAQ,CACxC,IAAI,CAAC,YACL,MAAM,CAAC,iBACP,EAAE,CAAC,SAAS,OACZ,EAAE,CAAC,eAAe,YAAY,2BAA2B;iBACzD,EAAE,CAAC,UAAU,UACb,KAAK,CAAC;gBAEX,IAAI,CAAC,cAAc;gBAEnB,6BAA6B;gBAC7B,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,2HAAQ,CACnC,IAAI,CAAC,cACL,MAAM,CAAC,sBACP,EAAE,CAAC,QAAQ,MACX,EAAE,CAAC,cAAc,aAAa,GAAG,CAAC,CAAA,IAAK,EAAE,EAAE;gBAEhD,MAAM,SAAiC,CAAC;gBACxC,qDAAqD;gBACrD,qGAAqG;gBACrG,aAAa,OAAO,CAAC,CAAA,IAAK,MAAM,CAAC,EAAE,EAAE,CAAC,GAAG;gBAEzC,IAAI,SAAS;oBACT,QAAQ,OAAO,CAAC,CAAC,IAAW,MAAM,CAAC,EAAE,UAAU,CAAC,GAAG,EAAE,MAAM;gBAC/D;gBAEA,YAAY;gBACZ,cAAc;YAElB,EAAE,OAAO,OAAO;gBACZ,QAAQ,KAAK,CAAC;YAClB,SAAU;gBACN,WAAW;YACf;QACJ;QAEA,IAAI,SAAS,YAAY;IAC7B,GAAG;QAAC;QAAO;QAAY;KAAK;IAE5B,MAAM,eAAe,CAAC;QAClB,cAAc,CAAA,OAAQ,CAAC;gBACnB,GAAG,IAAI;gBACP,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,KAAK,YAAY,WAAW;YAC5D,CAAC;IACL;IAEA,MAAM,iBAAiB;QACnB,UAAU;QACV,IAAI;YACA,MAAM,aAAa,SAAS,GAAG,CAAC,CAAA,IAAK,CAAC;oBAClC,YAAY,EAAE,EAAE;oBAChB,MAAM;oBACN,QAAQ,UAAU,CAAC,EAAE,EAAE,CAAC;gBAC5B,CAAC;YAED,uFAAuF;YACvF,iDAAiD;YACjD,gDAAgD;YAChD,sFAAsF;YAEtF,4EAA4E;YAC5E,MAAM,MAAM,SAAS,GAAG,CAAC,CAAA,IAAK,EAAE,EAAE;YAClC,MAAM,2HAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,GAAG,EAAE,CAAC,QAAQ,MAAM,EAAE,CAAC,cAAc;YAE7E,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,2HAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC;YAC3D,IAAI,OAAO,MAAM;YAEjB,MAAM;QACV,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC;YACd,MAAM;QACV,SAAU;YACN,UAAU;QACd;IACJ;IAEA,qBACI,8OAAC;QAAI,OAAO;YAAE,UAAU;YAAU,QAAQ;QAAS;;0BAC/C,8OAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAQ,gBAAgB;oBAAiB,YAAY;oBAAU,cAAc;gBAAO;;kCACvG,8OAAC;;0CACG,8OAAC;gCAAG,OAAO;oCAAE,UAAU;oCAAU,YAAY;gCAAO;0CAAG;;;;;;0CACvD,8OAAC;gCAAE,WAAU;0CAAa;;;;;;;;;;;;kCAE9B,8OAAC;wBAAI,OAAO;4BAAE,SAAS;4BAAQ,YAAY;4BAAU,KAAK;wBAAO;;0CAC7D,8OAAC;gCACG,MAAK;gCACL,OAAO;gCACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;gCACvC,WAAU;gCACV,OAAO;oCAAE,OAAO;gCAAO;;;;;;0CAE3B,8OAAC;gCAAO,SAAS;gCAAgB,UAAU;gCAAQ,WAAU;;kDACzD,8OAAC,0MAAI;wCAAC,MAAM;;;;;;kDACZ,8OAAC;kDAAM,SAAS,eAAe;;;;;;;;;;;;;;;;;;;;;;;;0BAK3C,8OAAC;gBAAI,WAAU;gBAAO,OAAO;oBAAE,cAAc;oBAAU,SAAS;oBAAQ,KAAK;gBAAO;;kCAChF,8OAAC;wBAAO,OAAO;wBAAO,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wBAAG,WAAU;;0CACvE,8OAAC;gCAAO,OAAM;0CAAuB;;;;;;0CACrC,8OAAC;gCAAO,OAAM;0CAAwB;;;;;;;;;;;;kCAG1C,8OAAC;wBACG,OAAO;wBACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;wBAC7C,WAAU;wBACV,aAAY;;;;;;;;;;;;0BAIpB,8OAAC;gBAAI,WAAU;gBAAO,OAAO;oBAAE,SAAS;gBAAE;0BACrC,wBACG,8OAAC;oBAAI,OAAO;wBAAE,SAAS;wBAAQ,WAAW;oBAAS;8BAAG;;;;;yCAEtD,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC;;0CACG,8OAAC;0CACG,cAAA,8OAAC;;sDACG,8OAAC;sDAAG;;;;;;sDACJ,8OAAC;sDAAG;;;;;;sDACJ,8OAAC;4CAAG,OAAO;gDAAE,WAAW;4CAAS;sDAAG;;;;;;;;;;;;;;;;;0CAG5C,8OAAC;0CACI,SAAS,GAAG,CAAC,CAAC,SAAS,kBACpB,8OAAC;wCAAoB,SAAS,IAAM,aAAa,QAAQ,EAAE;wCAAG,OAAO;4CAAE,QAAQ;4CAAW,YAAY,UAAU,CAAC,QAAQ,EAAE,CAAC,KAAK,WAAW,YAAY;wCAAc;;0DAClK,8OAAC;0DAAI,IAAI;;;;;;0DACT,8OAAC;gDAAG,OAAO;oDAAE,YAAY;gDAAI;0DAAI,QAAQ,SAAS;;;;;;0DAClD,8OAAC;gDAAG,OAAO;oDAAE,WAAW;gDAAS;0DAC5B,UAAU,CAAC,QAAQ,EAAE,CAAC,KAAK,0BACxB,8OAAC;oDAAI,OAAO;wDAAE,SAAS;wDAAe,YAAY;wDAAU,KAAK;wDAAU,OAAO;oDAAU;;sEACxF,8OAAC,0OAAW;4DAAC,MAAM;;;;;;sEACnB,8OAAC;sEAAK;;;;;;;;;;;yEAGV,8OAAC;oDAAI,OAAO;wDAAE,SAAS;wDAAe,YAAY;wDAAU,KAAK;wDAAU,OAAO;oDAAU;;sEACxF,8OAAC,uNAAO;4DAAC,MAAM;;;;;;sEACf,8OAAC;sEAAK;;;;;;;;;;;;;;;;;;uCAZb,QAAQ,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyBvD"}}]
}